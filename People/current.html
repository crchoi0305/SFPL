<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Current Members | SFPL</title>
  <link rel="stylesheet" href="../styles.css" />
</head>

<body class="page-flex">

  <!-- ✅ 공통 헤더 삽입 위치 -->
  <div id="site-header"></div>

  <main>
    <div class="container page-wrap">
      <h1 class="page-title">Current members</h1>
      <p><div id="currentGrid" class="people-grid" aria-label="Current members list"></div></p>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container footer-inner">
      <div><strong>친환경/기능성 고분자 연구실</strong></div>
      <div>© <span id="year"></span></div>
    </div>
  </footer>

  <script>

    // ✅ Current members JSON 로드 & 렌더
  (function () {
    const wrap = document.getElementById("currentGrid");
    if (!wrap) return;

    function el(tag, cls, text) {
      const x = document.createElement(tag);
      if (cls) x.className = cls;
      if (text != null) x.textContent = text;
      return x;
    }

    function pickMembers(data) {
      // CMS에서 저장 형태가 달라질 수 있어서 여러 키를 허용
      if (Array.isArray(data.members)) return data.members;
      if (Array.isArray(data.people)) return data.people;
      if (Array.isArray(data.items)) return data.items;
      return [];
    }

    function pickSrc(v) {
      // 문자열 또는 {src, alt} 형태 둘 다 지원
      if (!v) return "";
      if (typeof v === "string") return v;
      if (typeof v === "object" && v.src) return v.src;
      return "";
    }

    function renderCard(m) {
      const card = el("article", "person-card");

      const imgSrc = pickSrc(m.photo || m.image || m.avatar);
      if (imgSrc) {
        const img = document.createElement("img");
        img.className = "person-photo";
        img.src = imgSrc;
        img.alt = m.name ? `${m.name} photo` : "member photo";
        img.loading = "lazy";
        card.appendChild(img);
      }

      const name = el("div", "person-name", m.name || "Unnamed");
      card.appendChild(name);

      const roleText = m.role || m.position || m.title || "";
      if (roleText) card.appendChild(el("div", "person-role", roleText));

      const topicText = m.research || m.interest || m.topic || "";
      if (topicText) card.appendChild(el("div", "person-topic", topicText));

      const emailText = m.email || "";
      if (emailText) {
        const a = document.createElement("a");
        a.className = "person-email";
        a.href = "mailto:" + emailText;
        a.textContent = emailText;
        card.appendChild(a);
      }

      return card;
    }

    async function load() {
      try {
        // people/current.html → 상위 폴더의 content/current.json
        const url = "../content/current.json?v=" + Date.now();
        const res = await fetch(url, { cache: "no-store" });
        if (!res.ok) throw new Error("current.json load failed: " + res.status);

        const data = await res.json();
        const members = pickMembers(data);

        wrap.innerHTML = "";
        if (!members.length) {
          wrap.appendChild(el("div", "people-empty", "등록된 Current 멤버가 없습니다."));
          return;
        }

        members.forEach(m => wrap.appendChild(renderCard(m)));
      } catch (e) {
        console.error(e);
        wrap.innerHTML = `<div class="people-empty">데이터를 불러오지 못했습니다. (../content/current.json 확인)</div>`;
      }
    }

    load();
  })();
  
    /* =========================
       footer year
    ========================= */
    const y = document.getElementById("year");
    if (y) y.textContent = new Date().getFullYear();

    /* =========================
       header load (people/current.html → 상위 폴더)
    ========================= */
    fetch("../header.html")
      .then(res => {
        if (!res.ok) throw new Error("header.html load failed");
        return res.text();
      })
      .then(html => {
        document.getElementById("site-header").innerHTML = html;

        // (선택) People 메뉴 active 표시 (Current)
        document.querySelectorAll(".nav-link").forEach(a => a.classList.remove("active"));
        const desk = document.querySelector(
          '.nav-link[href="/people/current.html"], .nav-link[href="../people/current.html"]'
        );
        if (desk) desk.classList.add("active");

        const mob = document.querySelector(
          '#mobileNav .m-link[href="/people/current.html"], #mobileNav .m-link[href="../people/current.html"]'
        );
        if (mob) mob.classList.add("active");

        // hamburger toggle
        const btn = document.querySelector(".nav-toggle");
        const mobileNav = document.getElementById("mobileNav");
        if (btn && mobileNav) {
          btn.addEventListener("click", () => {
            const open = mobileNav.classList.toggle("open");
            btn.setAttribute("aria-expanded", String(open));
          });
        }

        // prevent jump for dropdown parents
        document
          .querySelectorAll(".dropdown-toggle, .mobile-nav .m-link[href='#']")
          .forEach(el => el.addEventListener("click", e => e.preventDefault()));

        // mobile submenu toggle
        document
          .querySelectorAll("#mobileNav [data-toggle='sub']")
          .forEach(t => {
            t.addEventListener("click", e => {
              e.preventDefault();
              const sub = t.nextElementSibling;
              if (sub && sub.classList.contains("m-sub")) sub.classList.toggle("open");
            });
          });
      })
      .catch(err => console.error(err));
  </script>

</body>
</html>
